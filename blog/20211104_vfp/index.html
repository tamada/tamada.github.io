<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Hugo 0.95.0" />
  <link rel="stylesheet" href="https://tamada.github.io/css/normalize.css">
  <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
  
  
  
  <link rel="stylesheet" href="https://tamada.github.io/css/cayman.ea0e967413f3851071cc8ace3621bc4205fe8fa79b2abe3d7bf94ff2841f0d47.css">
  
  
  <link rel="stylesheet" href="https://tamada.github.io/css/style.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css">

<script src="https://unpkg.com/mermaid@8.4.2/dist/mermaid.min.js"></script>
<script>mermaid.initialize({startOnLoad:true});</script>

  <link rel="apple-touch-icon" sizes="180x180" href="https://tamada.github.io/images/harry.png">
  <link rel="icon" type="image/png" sizes="32x32" href="https://tamada.github.io/images/harry.png">
  <link rel="icon" type="image/png" sizes="16x16" href="https://tamada.github.io/images/harry.png">
  
  
  
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-WQTS56KXPJ"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
  
    gtag('config', 'G-WQTS56KXPJ');
  </script>
  <title>â˜• How to get the version defined in pom.xml | Haruaki TAMADA</title>
</head>

<body>
  <section class="page-header">
  <div class="navigation"><a href="/tags">ğŸ·ï¸ Tags</a></div>
  
  <img src="https://tamada.github.io/images/harry.png" class="avatar" alt="project_logo">
  
  <h1 class="project-name">
    Haruaki TAMADA
  </h1>
  <h2 class="project-tagline">
    Researcher of Software Protectoin, and Developer!
  </h2>
  <nav>
    
    
    
    
    
    
    <a href="/" class="btn">ğŸ  Home</a>
    
    
    
    
    
    <a href="/projects" class="btn">ğŸš€ Projects</a>
    
    
    
    
    
    <a href="/research" class="btn">ğŸ’¡ Research</a>
    
    
    
    
    
    <a href="/profile" class="btn">ğŸ‘¤ Profile</a>
    
    
    
    
    
    <a href="/blog" class="btn">ğŸ¤” Blog</a>
    
  </nav>
</section>
  <section class="main-content">
    <div class="date">Nov 04, 2021</div><h1>â˜• How to get the version defined in pom.xml</h1><img src="/images//covers/48889569966_77ebd7368a_c.jpg" class="eyecatch"><ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#getting-ways-of-the-version-defined-in-pomxml">Getting ways of the version defined in <code>pom.xml</code></a>
<ul>
<li><a href="#constant">Constant</a></li>
<li><a href="#property">Property</a></li>
<li><a href="#package">Package</a></li>
<li><a href="#module">Module</a></li>
</ul>
</li>
<li><a href="#what-the-case-in-the-use-of-native-image">What the case in the use of <code>native-image</code>?</a>
<ul>
<li><a href="#result-of-measurements">Result of Measurements</a></li>
</ul>
</li>
<li><a href="#summary">Summary</a></li>
<li><a href="#appendix">Appendix</a> (2023-01-09è¿½è¨˜)</li>
<li><a href="#references">References</a></li>
</ul>
<h2 id="overview">Overview</h2>
<p>Java 17 ãŒå‡ºãŸã“ã¨ã ã—ï¼Œã„ã„åŠ æ¸›ã« Java ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã‚’æœ¬æ ¼çš„ã«ä½¿ã„ã ãã†ã¨ã—ã¦ã„ã‚‹ï¼
æœ€è¿‘ã® Java ã®è‡ªä½œãƒ„ãƒ¼ãƒ«ã¯ä¸€å¿œãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å¯¾å¿œã«ã—ãŸã¤ã‚‚ã‚Šï¼ˆ<a href="https://github.com/tamada/pochi">pochi</a>ï¼Œ<a href="https://github.com/tamada/vhc">vhc</a>ãªã©ï¼‰ï¼
ã•ã‚‰ã«ï¼Œ<a href="https://www.graalvm.org/">GraalVM</a> ã‚’ä½¿ã£ã¦ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚‚ä½œæˆã§ãã‚‹ãã†ãªã®ã§è‰²ã€…ã¨ã‚„ã£ã¦ã¿ãŸã„ï¼</p>
<p>ã§ï¼Œã‚¢ãƒ—ãƒªã‚’ä½œã‚‹ã¨ãã«ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±ã‚’å–å¾—ã—ãŸã„ã“ã¨ãŒã‚ã‚‹ï¼
ãã—ã¦ï¼Œå…·ä½“çš„ãªãƒãƒ¼ã‚¸ãƒ§ãƒ³ç•ªå·ã¯ï¼Œãƒ“ãƒ«ãƒ‰ãƒ„ãƒ¼ãƒ«ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ã‚¹ã‚¯ãƒªãƒ—ã‚¿ï¼ˆMaven ãªã‚‰<code>pom.xml</code>ï¼ŒGradle ãªã‚‰<code>build.gradle</code>?ï¼‰ã«æ›¸ãã“ã¨ãŒå¤šã„ï¼
ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç•ªå·ãŒè¤‡æ•°ç®‡æ‰€ã«æ›¸ã‹ã‚Œã¦ã„ã‚‹ã¨ï¼Œæ›´æ–°ãƒŸã‚¹ã§ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®ãƒŸã‚¹ãƒãƒƒãƒãŒèµ·ã“ã‚‹ã®ã§ï¼Œãƒãƒ¼ã‚¸ãƒ§ãƒ³ç•ªå·ã¯ä¸€ç®‡æ‰€ã§ç®¡ç†ã—ãŸã„ã®ãŒäººæƒ…ã§ã‚ã‚‹ï¼
ã¨ãªã‚‹ã¨ï¼Œã©ã®ã‚ˆã†ãªæ–¹æ³•ã§ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç•ªå·ã‚’å–å¾—ã™ã‚Œã°è‰¯ã„ã®ã ã‚ã†ã¨æ€ã„ï¼Œèª¿ã¹ã¦ã¿ãŸï¼
ã“ã‚Œã¾ã§ã¯ç‰¹ã«æ„è­˜ã›ãšãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‹ã‚‰èª­ã¿è¾¼ã‚“ã ã‚Šï¼Œ<code>Package</code>ã‚¯ãƒ©ã‚¹ã‚’ä½¿ã£ãŸã‚Šã—ã¦ã„ãŸï¼
ã—ã‹ã—ï¼Œå®Ÿè¡Œæ–¹æ³•ï¼ˆ<code>-jar</code>ã‚„<code>--module</code>ï¼‰ã®é•ã„ã‚„ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒ³ã‚°ã®æ–¹æ³•ã®é•ã„ã§ï¼Œå–å¾—ã§ããªã„ã“ã¨ãŒã‚ã‚‹ã®ã‹ã‚’èª¿ã¹ã¦ã¿ãŸï¼</p>
<p>ç§ãŒã‚ˆãä½¿ã†ãƒ“ãƒ«ãƒ‰ãƒ„ãƒ¼ãƒ«ã¯ <a href="https://maven.apache.org">Maven</a> ã§ã‚ã‚‹ã®ã§ï¼Œ<code>pom.xml</code> ã§è¨­å®šã—ãŸãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±ã‚’ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‹ã‚‰ã©ã‚“ãªæƒ…å ±ã§å–å¾—ã§ãã‚‹ã‹ã‚’ç¢ºèªã—ã¦ã¿ãŸï¼
Gradle ã®å ´åˆã§ã‚‚ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç•ªå·ã‚’åŸ‹ã‚è¾¼ã‚€æ–¹æ³•ã«å¤šå°‘ã®é•ã„ãŒã‚ã‚‹ã ã‘ã§ï¼Œå¤§ããªé•ã„ã¯ãªã„ï¼</p>
<h2 id="getting-ways-of-the-version-defined-in-pomxml">Getting ways of the version defined in <code>pom.xml</code></h2>
<p>ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç•ªå·ã‚’å–å¾—ã™ã‚‹æ–¹æ³•ã¯ï¼Œæ¬¡ã® 4 ã¤ã®æ–¹æ³•ã«åˆ†é¡ã§ãã‚‹ï¼</p>
<ol>
<li><strong>Constant</strong>: è‡ªåˆ†ã§ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®æ–‡å­—åˆ—ã‚’<code>String</code>å‹ãƒªãƒ†ãƒ©ãƒ«ã¨ã—ã¦ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã«æ›¸ãè¾¼ã‚€ï¼</li>
<li><strong>Property</strong>: <code>src/main/resources</code>ã«ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±ã‚’ç½®ã„ã¦ãŠãï¼</li>
<li><strong>Package</strong>: <code>MANIFEST.MF</code>ã«æ›¸ã‹ã‚Œã¦ã„ã‚‹ <code>Implementation-Version</code>ã‚„<code>Specification-Version</code>ã®ã„ãšã‚Œã‹ã‚’åˆ©ç”¨ã™ã‚‹ï¼</li>
<li><strong>Module</strong>: <code>ModuleDescriptor</code>ã®<code>version</code>ãƒ¡ã‚½ãƒƒãƒ‰ã‹ã‚‰åˆ©ç”¨ã™ã‚‹ï¼</li>
</ol>
<p>ãã‚Œãã‚Œã®åˆ†é¡ã‚’ç‹¬æ–­ã¨åè¦‹ã§ï¼”æ®µéšã§è©•ä¾¡ã—ã¦ã¿ãŸï¼ˆ1 ãŒè‰¯ãã¦ï¼Œï¼”ãŒæ‚ªã„ï¼‰ï¼</p>
<table>
<thead>
<tr>
<th></th>
<th>Constant</th>
<th>Property</th>
<th>Package</th>
<th>Module</th>
</tr>
</thead>
<tbody>
<tr>
<td>ã‚ã‹ã‚Šã‚„ã™ã•</td>
<td>1</td>
<td>2</td>
<td>3</td>
<td>4</td>
</tr>
<tr>
<td>å–å¾—ã®ã—ã‚„ã™ã•</td>
<td>1</td>
<td>2</td>
<td>2</td>
<td>2</td>
</tr>
<tr>
<td>è‡ªå‹•åŒ–</td>
<td>3</td>
<td>2</td>
<td>1</td>
<td>3</td>
</tr>
</tbody>
</table>
<p>åˆ†ã‹ã‚Šã‚„ã™ã•ã¯ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç•ªå·å–å¾—ãƒ«ãƒ¼ãƒãƒ³ã‚’ã¿ãŸã¨ãã®ã‚ã‹ã‚Šã‚„ã™ã•ï¼<strong>Constant</strong>ã¯å˜ãªã‚‹å¤‰æ•°å‚ç…§ãªã®ã§ä¸€ç•ªã‚ã‹ã‚Šã‚„ã™ã„ã§ã‚ã‚ã†ï¼<strong>Property</strong>ã¯ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ¢ã—ï¼Œèª­ã¿è¾¼ã¿ï¼Œã‚¨ãƒ³ãƒˆãƒªã‚’å–å¾—ã™ã‚‹ï¼Œã¨ã„ã†ï¼“æ®µéšãŒå¿…è¦ã¨ãªã‚‹ï¼</p>
<p><strong>Package</strong>ã¯ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç•ªå·å–å¾—ã®å‡¦ç†è‡ªä½“ã¯ãã‚Œã»ã©é›£ã—ãã¯ãªã„ï¼ãŸã ã—ï¼Œãªãœãã®ã‚ˆã†ã«å–å¾—ã§ãã‚‹ã®ã‹ï¼Œã©ã†ã‚„ã‚Œã°ãã®ã‚ˆã†ã«å–å¾—ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã®ã‹ã«å¯¾ã—ã¦ï¼Œjar ãƒ•ã‚¡ã‚¤ãƒ«ï¼ŒMANIFEST ãƒ•ã‚¡ã‚¤ãƒ«ãªã©ã®çŸ¥è­˜ãŒå¿…è¦ã«ãªã‚‹ãŸã‚ <strong>Property</strong>ã‚ˆã‚Šã‚‚é›£ã—ã„ã¨åˆ¤æ–­ã—ã¦ã„ã‚‹ï¼</p>
<p>åŒæ§˜ã«<strong>Module</strong>ã‚‚ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç•ªå·å–å¾—ã®å‡¦ç†è‡ªä½“ã¯<strong>Package</strong>ã¨åŒæ§˜ã§ã‚ã‚‹ãŒï¼Œã‚„ã¯ã‚Šãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã«å¯¾ã™ã‚‹ç†è§£ãŒå¤šå°‘ãªã‚Šã¨ã‚‚å¿…è¦ã§ã‚ã‚‹ãŸã‚ï¼Œ<strong>Package</strong>ã‚ˆã‚Šã‚‚é›£ã—ã„ã¨åˆ¤æ–­ã—ãŸï¼</p>
<h3 id="constant">Constant</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">VersionProvider</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> String VERSION <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;1.0.0&#34;</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">version</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> VERSION<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>ã¿ãŸã„ãªæ„Ÿã˜ï¼è¨­å®šã¯åˆ†ã‹ã‚Šã‚„ã™ã„ã—ï¼Œå‚ç…§ã‚‚ã—ã‚„ã™ã„ï¼ã‘ã‚Œã©è‡ªå‹•åŒ–ã®ãŸã‚ã«ã¯åˆ¥é€”ã‚¹ã‚¯ãƒªãƒ—ãƒˆãªã©ãŒå¿…è¦ã¨ãªã‚ã†ï¼Maven ã®<a href="https://stackoverflow.com/questions/4106171/filtering-source-code-in-maven"><code>templating-maven-plugin</code>ã‚’ä½¿ã†æ–¹æ³•ã‚‚ã‚ã‚ã†</a>ï¼</p>
<h3 id="property">Property</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">VersionProvider</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">version</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    URL url <span style="color:#f92672">=</span> getClass<span style="color:#f92672">().</span><span style="color:#a6e22e">getResource</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/resources/version.properties&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span><span style="color:#f92672">(</span>InputStream in <span style="color:#f92672">=</span> url<span style="color:#f92672">.</span><span style="color:#a6e22e">openStream</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>      Properties p <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Properties<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>      p<span style="color:#f92672">.</span><span style="color:#a6e22e">load</span><span style="color:#f92672">(</span>in<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> p<span style="color:#f92672">.</span><span style="color:#a6e22e">getProperty</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;someapp.version&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span><span style="color:#f92672">(</span>IOException e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> InternalError<span style="color:#f92672">(</span>e<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// IOExceptionãŒç™ºç”Ÿã™ã‚‹ã¨ã„ã†ã“ã¨ã¯ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ä½•ã‹ãŒãŠã‹ã—ã„ãŸã‚ï¼Œ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#75715e">// ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è‡ªä½“ã‚’çµ‚äº†ã•ã›ã‚‹ï¼
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><h4 id="srcmainresourcesresourcesversionproperties"><code>src/main/resources/resources/version.properties</code></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>someapp.version=${project.version}
</span></span></code></pre></div><p>ã“ã‚“ãªæ„Ÿã˜ï¼<code>pom.xml</code> ã«æ¬¡ã®ã‚ˆã†ãªã‚¨ãƒ³ãƒˆãƒªã‚’å…¥ã‚Œã¦ãŠãã¨ä¸Šè¨˜ã®<code>${project.version}</code>ã‚’è‡ªå‹•çš„ã«<code>version</code>ã‚¿ã‚°ã®å†…å®¹ã«ç½®ãæ›ãˆã¦ãã‚Œã‚‹ï¼</p>
<p>ä¸€åº¦è¨­å®šã™ã‚‹ã¨å–å¾—ã§ããªããªã‚‹ã“ã¨ã¯ã‚ã¾ã‚Šè€ƒãˆã‚‰ã‚Œãªã„ãŒï¼Œä¸‡ãŒä¸€ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±ãŒå–å¾—ã§ããªããªã£ãŸå ´åˆï¼Œé€Ÿã‚„ã‹ã«å¯¾å¿œã—ãªã„ã¨ã„ã‘ãªã„ãŸã‚ï¼Œå–å¾—ã§ããªã‹ã£ãŸå ´åˆã«<code>InternalError</code>ã§çµ‚äº†ã™ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã‚‹ï¼</p>
<h4 id="pomxml"><code>pom.xml</code></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;build&gt;</span>
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;resources&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;resource&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;directory&gt;</span>src/main/resources<span style="color:#f92672">&lt;/directory&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;filtering&gt;</span>true<span style="color:#f92672">&lt;/filtering&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;/resource&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;/resources&gt;</span>
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;/build&gt;</span>
</span></span><span style="display:flex;"><span>...
</span></span></code></pre></div><h3 id="package">Package</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">VersionProvider</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">version</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> getClass<span style="color:#f92672">().</span><span style="color:#a6e22e">getPackage</span><span style="color:#f92672">()</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">.</span><span style="color:#a6e22e">getImplementationVersion</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>ã“ã‚Œã¯ jar ãƒ•ã‚¡ã‚¤ãƒ«å†…ã®<code>META-INF/MANIFEST.MF</code>ã«æ›¸ã‹ã‚Œã¦ã„ã‚‹ã‚¨ãƒ³ãƒˆãƒªã‚’èª­ã‚“ã§å‡ºåŠ›ã—ã¦ã„ã‚‹ï¼ã“ã®ã‚¨ãƒ³ãƒˆãƒªã‚’è¿½åŠ ã™ã‚‹ã«ã¯ï¼Œ<code>pom.xml</code>ã«æ¬¡ã®ã‚ˆã†ãªã‚¨ãƒ³ãƒˆãƒªã‚’å…¥ã‚Œã¦ãŠãã¨è‰¯ã„ï¼</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>  ...
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;build&gt;</span>
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;plugins&gt;</span>
</span></span><span style="display:flex;"><span>      ...
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;plugin&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;groupId&gt;</span>org.apache.maven.plugins<span style="color:#f92672">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;artifactId&gt;</span>maven-jar-plugin<span style="color:#f92672">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;version&gt;</span>3.1.2<span style="color:#f92672">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;configuration&gt;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&lt;archive&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;manifest&gt;</span>
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">&lt;addDefaultImplementationEntries&gt;</span>true<span style="color:#f92672">&lt;/addDefaultImplementationEntries&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;/manifest&gt;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&lt;/archive&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;/configuration&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;/plugin&gt;</span>
</span></span><span style="display:flex;"><span>      ...
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;/plugins&gt;</span>
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;/build&gt;</span>
</span></span><span style="display:flex;"><span>...
</span></span></code></pre></div><h3 id="module">Module</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">VersionProvider</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">version</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> getClass<span style="color:#f92672">().</span><span style="color:#a6e22e">getModule</span><span style="color:#f92672">()</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">.</span><span style="color:#a6e22e">getDescriptor</span><span style="color:#f92672">()</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">.</span><span style="color:#a6e22e">version</span><span style="color:#f92672">().</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>ã“ã‚Œã§å–å¾—ã§ãã‚‹ã¯ãšï¼<code>module-info.java</code>ã§ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’è¨­å®šã™ã‚‹ç®‡æ‰€ã¯ãªã„ãŸã‚ï¼Œjar ãƒ•ã‚¡ã‚¤ãƒ«ã§ã¯è¨­å®šã§ããªã„ã¨æ€ã‚ã‚Œã‚‹ï¼</p>
<p>jmod ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹<code>jmod</code>ã‚³ãƒãƒ³ãƒ‰ã«<a href="https://docs.oracle.com/javase/jp/11/tools/jmod.html"><code>--module-version</code>ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒã‚ã‚‹</a>ãŸã‚ï¼Œã“ã‚Œã‚’åˆ©ç”¨ã—ã¦æŒ‡å®šã™ã‚‹ã®ã§ã‚ã‚ã†ï¼</p>
<h2 id="what-the-case-in-the-use-of-native-image">What the case in the use of <code>native-image</code>?</h2>
<p>ã§ï¼Œã“ã“ã‹ã‚‰ãŒæœ¬ç•ªï¼<a href="https://www.graalvm.org/">GraalVM</a> ã‚’ä½¿ã£ã¦ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½œæˆã—ãŸã¨ãã«ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±ã‚’å–å¾—ã§ããªããªã£ã¦ã„ã‚‹ã®ã¯ã„ãŸã ã‘ãªã„ï¼</p>
<p>ã¨ã„ã†ã“ã¨ã§ï¼Œæ¬¡ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ç”¨æ„ã—ãŸï¼ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®å…¨è²Œã¯ <a href="https://github.com/tamada/version_from_pom">tamada/version_from_pom</a>ã«ã‚ã‚‹ã®ã§å‚ç…§ã•ã‚ŒãŸã„ï¼ãªãŠï¼Œã©ã‚Œãã‚‰ã„å·®ãŒå‡ºã‚‹ã‹ã¯ã‚ã‹ã‚‰ãªã„ãŒæ™‚é–“ã‚‚è¨ˆæ¸¬ã—ã¦ã¿ãŸï¼</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">VersionProvider</span> <span style="color:#66d9ef">extends</span> Supplier<span style="color:#f92672">&lt;</span>Pair<span style="color:#f92672">&lt;</span>Version<span style="color:#f92672">,</span> String<span style="color:#f92672">&gt;&gt;</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// èª­ã¿è¾¼ã‚“ã ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç•ªå·ã¨ã©ã“ã‹ã‚‰èª­ã¿è¾¼ã‚“ã ã‹ã‚’è¿”ã™ï¼
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        Pair<span style="color:#f92672">&lt;</span>Version<span style="color:#f92672">,</span> String<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">get</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">perform</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        Stream<span style="color:#f92672">.</span><span style="color:#a6e22e">of</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> ConstantVersionProvider<span style="color:#f92672">(),</span> <span style="color:#66d9ef">new</span> PropertyVersionProvider<span style="color:#f92672">(),</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#66d9ef">new</span> PackageVersionProvider<span style="color:#f92672">(),</span> <span style="color:#66d9ef">new</span> ModuleVersionProvider<span style="color:#f92672">())</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">.</span><span style="color:#a6e22e">forEach</span><span style="color:#f92672">(</span>provider <span style="color:#f92672">-&gt;</span> printResult<span style="color:#f92672">(</span>provider<span style="color:#f92672">));</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">printResult</span><span style="color:#f92672">(</span>VersionProvider provider<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        var result <span style="color:#f92672">=</span> measure<span style="color:#f92672">(()</span> <span style="color:#f92672">-&gt;</span> provider<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>        Pair<span style="color:#f92672">&lt;</span>Version<span style="color:#f92672">,</span> String<span style="color:#f92672">&gt;</span> pair <span style="color:#f92672">=</span> result<span style="color:#f92672">.</span><span style="color:#a6e22e">right</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        String version <span style="color:#f92672">=</span> String<span style="color:#f92672">.</span><span style="color:#a6e22e">valueOf</span><span style="color:#f92672">(</span>pair<span style="color:#f92672">.</span><span style="color:#a6e22e">left</span><span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">long</span> time <span style="color:#f92672">=</span> result<span style="color:#f92672">.</span><span style="color:#a6e22e">left</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">printf</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;%5s,%10d nano sec,%s%n&#34;</span><span style="color:#f92672">,</span> version<span style="color:#f92672">,</span> time<span style="color:#f92672">,</span> pair<span style="color:#f92672">.</span><span style="color:#a6e22e">right</span><span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#f92672">&lt;</span>R<span style="color:#f92672">&gt;</span> Pair<span style="color:#f92672">&lt;</span>Long<span style="color:#f92672">,</span> R<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">measure</span><span style="color:#f92672">(</span>Supplier<span style="color:#f92672">&lt;</span>R<span style="color:#f92672">&gt;</span> supplier<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">long</span> from <span style="color:#f92672">=</span> System<span style="color:#f92672">.</span><span style="color:#a6e22e">nanoTime</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        R result <span style="color:#f92672">=</span> supplier<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> Pair<span style="color:#f92672">.</span><span style="color:#a6e22e">of</span><span style="color:#f92672">(</span>System<span style="color:#f92672">.</span><span style="color:#a6e22e">nanoTime</span><span style="color:#f92672">()</span> <span style="color:#f92672">-</span> from<span style="color:#f92672">,</span> result<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ConstantVersionProvider</span> <span style="color:#66d9ef">implements</span> VersionProvider <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">...</span> <span style="color:#75715e">// ä¸Šè¨˜ã® Constant ã¨ã»ã¼åŒã˜
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">PropertyVersionProvider</span> <span style="color:#66d9ef">implements</span> VersionProvider <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">...</span> <span style="color:#75715e">// ä¸Šè¨˜ã® Property ã¨ã»ã¼åŒã˜
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">PackageVersionProvider</span> <span style="color:#66d9ef">implements</span> VersionProvider <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">...</span> <span style="color:#75715e">// ä¸Šè¨˜ã® Package ã¨ã»ã¼åŒã˜
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ModuleVersionProvider</span> <span style="color:#66d9ef">implements</span> VersionProvider <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">...</span> <span style="color:#75715e">// ä¸Šè¨˜ã® Module ã¨ã»ã¼åŒã˜
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#f92672">}</span>
</span></span></code></pre></div><p>ã“ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’æ¬¡ã® 5 ã¤ã®æ–¹æ³•ã§å®Ÿè¡Œã—ãŸçµæœã‚’ç¤ºã™ï¼</p>
<ul>
<li><strong>Plain</strong>: <code>java -cp target/classes jp.cafebabe.vfp.Main</code>
<ul>
<li>jar ã«ã¾ã¨ã‚ãªã„ã¾ã¾å®Ÿè¡Œã™ã‚‹æ–¹æ³•ï¼</li>
</ul>
</li>
<li><strong>Jar</strong>: <code>java -jar target/mods/vfp-1.0.0.jar</code>
<ul>
<li>Java 8 ä»¥å‰ã®æ™®é€šã®å®Ÿè¡Œæ–¹æ³•ï¼Œ</li>
</ul>
</li>
<li><strong>Module</strong>: <code>java --module-path target/mods --module jp.cafebabe.vfp/jp.cafebabe.vfp.Main</code>
<ul>
<li>Modular jar ã¨ã—ã¦å®Ÿè¡Œã™ã‚‹ï¼</li>
</ul>
</li>
<li><strong>Native-Jar</strong>: <code>native-image -jar target/mods/vfp-1.0.0.jar vfp-jar</code>
<ul>
<li><code>native-image</code> ã§ jar ã‚’æ¸¡ã—ã¦å®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¦ï¼Œä½œæˆã•ã‚ŒãŸå®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ«ã‚’å®Ÿè¡Œã™ã‚‹ï¼</li>
</ul>
</li>
<li><strong>Native-Module</strong>: <code>native-image --module-path target/mods --module jp.cafebabe.vfp/jp.cafebabe.vfp.Main vfp-module</code>
<ul>
<li><code>native-image</code>ã« modular jar ã‚’æŒ‡å®šã—ã¦å®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹ï¼ãã—ã¦ï¼Œä½œæˆã•ã‚ŒãŸå®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ«ã‚’å®Ÿè¡Œã™ã‚‹ï¼</li>
</ul>
</li>
</ul>
<p><a href="https://docs.oracle.com/javase/jp/14/docs/specs/man/jmod.html"><code>jmod</code>ã‚³ãƒãƒ³ãƒ‰</a>ã§ä½œæˆã•ã‚ŒãŸ jmod ãƒ•ã‚¡ã‚¤ãƒ«ã¯<a href="https://docs.oracle.com/javase/jp/11/tools/jmod.html">å®Ÿè¡Œã§ããªã„</a>ï¼ãŸã ã—ï¼Œ<code>jmod</code>ã‚³ãƒãƒ³ãƒ‰ã§ã¯ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®æŒ‡å®šãŒè¡Œãˆã‚‹ï¼ˆ<code>--module-version</code>ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§æŒ‡å®šã§ãã‚‹ï¼‰ï¼ã§ã¯ï¼Œ<code>jmod</code>ã‚³ãƒãƒ³ãƒ‰ã§ä½œæˆã•ã‚ŒãŸ jmod ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸­ã‹ã‚‰ <code>module-info.class</code> ã‚’å–ã‚Šå‡ºã—ï¼Œå…ƒã®<code>module-info.class</code> ã‚’ç½®ãæ›ãˆã¦<code>classes2</code>ã«ç½®ãï¼ãã—ã¦ï¼Œ<code>classes2</code>ã‹ã‚‰æ–°ãŸã« jar ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¦ã¿ãŸï¼<code>mods2/vfp2-1.0.0.jar</code> ã¨ã™ã‚‹ï¼ã“ã‚Œã§ã‚‚å®Ÿè¡Œã—ã¦ã¿ã‚‹ï¼</p>
<ul>
<li><strong>Plain2</strong>: <code>java -cp classes2 jp.cafebabe.vfp.Main</code></li>
<li><strong>Jar2</strong>: <code>java -jar target/mods2/vfp2-1.0.0.jar</code></li>
<li><strong>Native-Jar2</strong>: <code>native-image -jar target/mods2/vfp2-1.0.0.jar vfp2-jar</code></li>
<li><strong>Native-Module2</strong>: <code>native-image --module-path target/mods2 --module jp.cafebabe.vfp/jp.cafebabe.vfp.Main vfp2-module</code></li>
</ul>
<h3 id="result-of-measurements">Result of Measurements</h3>
<p>çµæœã‚’ä»¥ä¸‹ã«ç¤ºã™ï¼åˆ—ãŒãƒãƒ¼ã‚¸ãƒ§ãƒ³ç•ªå·ã®å–å¾—æ–¹æ³•ï¼Œè¡ŒãŒå®Ÿè¡Œæ–¹æ³•ã‚’è¡¨ã—ã¦ã„ã‚‹ï¼å®Ÿè¡Œç’°å¢ƒã¯ macOS Big Sur (11.6)ï¼Œãƒãƒƒãƒ— Apple M1, ãƒ¡ãƒ¢ãƒª 16GBï¼Œgraalvm64-17.0.1 ã§ã‚ã‚‹ï¼</p>
<table>
<thead>
<tr>
<th></th>
<th style="text-align:right">Constant</th>
<th style="text-align:right">Property</th>
<th style="text-align:right">Package</th>
<th style="text-align:right">Module</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Plain</strong></td>
<td style="text-align:right">563,500 nsec</td>
<td style="text-align:right">7,336,375 nsec</td>
<td style="text-align:right">null</td>
<td style="text-align:right">Exception</td>
</tr>
<tr>
<td><strong>Jar</strong></td>
<td style="text-align:right">3,145,250 nsec</td>
<td style="text-align:right">29,883,833 nsec</td>
<td style="text-align:right">25,667 nsec</td>
<td style="text-align:right">Exception</td>
</tr>
<tr>
<td><strong>Module</strong></td>
<td style="text-align:right">179,583 nsec</td>
<td style="text-align:right">9,867,208 nsec</td>
<td style="text-align:right">null</td>
<td style="text-align:right">null</td>
</tr>
<tr>
<td><strong>Native-Jar</strong></td>
<td style="text-align:right">35,791 nsec</td>
<td style="text-align:right">Exception</td>
<td style="text-align:right">1,442,458 nsec</td>
<td style="text-align:right">Exception</td>
</tr>
<tr>
<td><strong>Native-Module</strong></td>
<td style="text-align:right">113,875 nsec</td>
<td style="text-align:right">Exception</td>
<td style="text-align:right">null</td>
<td style="text-align:right">null</td>
</tr>
<tr>
<td><strong>Plain2</strong></td>
<td style="text-align:right">396,000 nsec</td>
<td style="text-align:right">12,512,417 nsec</td>
<td style="text-align:right">null</td>
<td style="text-align:right">Exception</td>
</tr>
<tr>
<td><strong>Jar2</strong></td>
<td style="text-align:right">556,750 nsec</td>
<td style="text-align:right">40,243,417 nsec</td>
<td style="text-align:right">57,875 nsec</td>
<td style="text-align:right">Exception</td>
</tr>
<tr>
<td><strong>Module2</strong></td>
<td style="text-align:right">145,708 nsec</td>
<td style="text-align:right">19,945,375 nsec</td>
<td style="text-align:right">null</td>
<td style="text-align:right">38,522,208 nsec</td>
</tr>
<tr>
<td><strong>Native-Jar2</strong></td>
<td style="text-align:right">41,583 nsec</td>
<td style="text-align:right">Exception</td>
<td style="text-align:right">1,448,750 nsec</td>
<td style="text-align:right">Exception</td>
</tr>
<tr>
<td><strong>Native-Module2</strong></td>
<td style="text-align:right">94,125 nsec</td>
<td style="text-align:right">Exception</td>
<td style="text-align:right">null</td>
<td style="text-align:right">193,166 nsec</td>
</tr>
</tbody>
</table>
<p>è¡¨ã‹ã‚‰ã‚ã‹ã‚‹ã‚ˆã†ã«ï¼Œä¸€ç•ªç°¡å˜ã§é«˜é€Ÿãªã®ã¯<strong>Constant</strong> ã§ã‚ã‚‹ãŒï¼Œè‡ªå‹•åŒ–ã—ã¦ãŠã‹ãªã‘ã‚Œã°å®Ÿéš›ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¨è¡¨ç¤ºã•ã‚Œã‚‹ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«å·®ãŒå‡ºã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ï¼</p>
<p>ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚³ãƒ¼ãƒ‰ã§ãªã„å ´åˆã¯ï¼Œ<strong>Property</strong> ãŒå®‰å®šã—ã¦å–å¾—ã§ãã‚‹ã‚‚ã®ã®ï¼Œé…ã„ï¼å®Ÿè¡Œæ–¹æ³•ã«ã‚ˆã£ã¦ï¼Œ<strong>Package</strong>ï¼Œ<strong>Module</strong>ã§å–å¾—ã§ãã‚‹ã‹å¦ã‹ãŒæ±ºã‚ã‚‰ã‚Œã‚‹ï¼ã¦è¨€ã†ã‹ãªã‚“ã§ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚³ãƒ¼ãƒ‰ã«ã™ã‚‹ã¨å–å¾—ã§ããªããªã‚‹ã‚“ã ã‚ˆã†ï¼</p>
<p>ãªãŠï¼Œ<strong>Module</strong>ã‹ã‚‰ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’å–å¾—ã™ã‚‹ãŸã‚ã«ã¯ï¼Œä¸Šã§ã‚‚è¿°ã¹ãŸã‚ˆã†ã«<code>module-info.class</code>ã«ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±ã‚’åŠ ãˆã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ãã®ãŸã‚ã«ã¯ï¼Œ<code>jmod</code>ã‚³ãƒãƒ³ãƒ‰ã§ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æŒ‡å®šã—ãŸ jmod ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ï¼Œãã“ã‹ã‚‰<code>module-info.class</code>ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ jar ãƒ•ã‚¡ã‚¤ãƒ«ãªã©ã‚’ä½œæˆã—ç›´ã™å¿…è¦ãŒã‚ã‚‹ï¼ˆã‚ã‚“ã©ãã›ï¼ï¼ï¼ï¼‰ï¼</p>
<p>åŠ ãˆã¦ï¼Œ<code>native-image</code>ã®å®Ÿè¡Œã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§å–å¾—ã§ãã‚‹æƒ…å ±ãŒç•°ãªã‚‹ã®ã¯æ³¨æ„ãŒå¿…è¦ã§ã‚ã‚ã†ï¼
ä¸€ç•ªå®‰å®šã—ã¦å–å¾—ã§ãã‚‹ã®ãŒ<strong>Constant</strong>ãªã®ã¯æ„å¤–ã§ã‚‚ãªã‚“ã§ã‚‚ãªããã®é€šã‚Šãªã®ã ãŒï¼Œã‚ã¾ã‚Šé¢ç™½ããªã„çµæœã ãªï¼
<strong>Module</strong> ã§ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç•ªå·ã‚’å–å¾—ã§ãã‚‹ã®ã¯è‰¯ã„ã¨ã—ã¦ï¼Œæº–å‚™ãŒå¤§å¤‰ï¼ã‚‚ã£ã¨ç°¡æ˜“ã«ã§ãã‚‹æ–¹æ³•ã¯ãªã„ã®ã‹ãªï¼Ÿï¼Ÿï¼Ÿ</p>
<p>ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚³ãƒ¼ãƒ‰ã‚’ä½œæˆã™ã‚‹ã¨ãã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼ˆ<code>-jar</code>ã¨<code>-module</code>ï¼‰ã§å¤‰æ•°ã®å‚ç…§ã®å®Ÿè¡Œæ™‚é–“ã«å¤§ããªå·®ãŒå‡ºã‚‹ã®ã¯ãªã‚“ã§ã ã‚ã†ï¼</p>
<h2 id="summary">Summary</h2>
<p>çµå±€ã®ã¨ã“ã‚ï¼Œãƒãƒ¼ã‚¸ãƒ§ãƒ³ç•ªå·ã¯å®šæ•°ã¨ã—ã¦æ‰±ã†ã®ãŒç°¡å˜ã§ï¼Œã©ã®ã‚ˆã†ãªå½¢æ…‹ã§å®Ÿè¡Œã•ã‚Œã‚ˆã†ãŒåŒæ§˜ã«å–å¾—ã§ãã‚‹ï¼ã“ã®ã“ã¨ã‹ã‚‰å®šæ•°ã¨ã—ã¦æ‰±ã†ã®ãŒä¸€ç•ªè‰¯ã„ã‚ˆã†ã«æ€ã†ï¼ãŸã ã—ï¼Œå®šæ•°ã¨ã—ã¦æ‰±ã†å ´åˆï¼Œãƒãƒ¼ã‚¸ãƒ§ãƒ³ç•ªå·ã‚’æ›´æ–°ã—ãŸã¨ãã«è‡ªå‹•çš„ã«å®šæ•°ã®å€¤ã‚‚æ›´æ–°ã•ã‚Œã‚‹ã‚ˆã†ãªä»•çµ„ã¿ã‚’å°å…¥ã—ã¦ãŠã‹ãªã‘ã‚Œã°å®šç¾©ã¨å‡ºåŠ›ã«å·®ç•°ãŒç”Ÿã˜ã‚‹ï¼</p>
<p>æ¬¡ã«<strong>Package</strong>ã‚‚ã—ãã¯<strong>Module</strong>ã§å–å¾—ã™ã‚‹ã®ãŒè‰¯ã„ãŒï¼Œnative-image ã§ãƒ“ãƒ«ãƒ‰ã™ã‚‹ã¨ãã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã«æ³¨æ„ã—ãªã„ã¨ã„ã‘ãªã„ï¼æ³¨æ„ã—ãªã„ã¨ã„ã‘ãªã„ã¨æ›¸ã„ã¦ã„ã‚‹æ™‚ç‚¹ã§ãƒ€ãƒ¡ã ã‘ã©ï¼
<strong>Property</strong>ã¯ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚¤ãƒ¡ãƒ¼ã‚¸ã«ã™ã‚‹å¿…è¦ãŒãªã„å ´åˆã¯ OK ã ãŒï¼Œãã†ã§ãªã„å ´åˆã‚„ã‚ãŸæ–¹ãŒè‰¯ã„ï¼äºˆæƒ³å¤–ã®ã‚¨ãƒ©ãƒ¼ã§æ‚©ã¾ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ã§ã‚ã‚‹ï¼</p>
<p>å®Ÿè¡Œæ™‚é–“ã¯ã„ãšã‚Œã®æ–¹æ³•ã§ã‚‚èª¤å·®ã®ç¯„å›²ã§ã‚ã‚ã†ï¼ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç•ªå·å–å¾—ã®ã¿ã®æ™‚é–“ã§è¦‹ã‚‹ã¨ãã‚Œãã‚ŒãŒå¤§ããªå·®ã®ã‚ˆã†ã«æ€ãˆã‚‹ãŒï¼Œå®Ÿéš›ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®å ´åˆï¼Œãƒãƒ¼ã‚¸ãƒ§ãƒ³ç•ªå·å–å¾—ä»¥å¤–ã«ã‚‚æ§˜ã€…ãªå‡¦ç†ãŒè¡Œã‚ã‚Œã‚‹ï¼ãã®ã‚ˆã†ãªæ§˜ã€…ãªå‡¦ç†ã®ä¸­ã‹ã‚‰è¦‹ã‚‹ã¨ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç•ªå·å–å¾—ã®æ™‚é–“çŸ­ç¸®ã«æ°—ã‚’é…ã‚‹ã‚ˆã‚Šã‚‚ä»–ã®å‡¦ç†ã®çŸ­ç¸®ã«æ°—ã‚’é…ã‚‹æ–¹ãŒå»ºè¨­çš„ã§ã‚ã‚‹ãŸã‚ã§ã‚ã‚‹ï¼</p>
<h2 id="appendix">Appendix</h2>
<p>(2023-01-09è¿½è¨˜)</p>
<p>native-image ã§ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¾ã›ã‚‹ã‚ˆã†ã«ã™ã‚‹ã«ã¯ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§æŒ‡å®šã—ãªã„ã¨ã„ã‘ãªã„ã‚‰ã—ã„ï¼
ã§ï¼ŒæŒ‡å®šã™ã‚‹ã‚ˆã†ã«ã—ã¦å†å®Ÿé¨“ã—ã¦ã¿ãŸï¼</p>
<table>
<thead>
<tr>
<th></th>
<th style="text-align:right">Constant</th>
<th style="text-align:right">Property</th>
<th style="text-align:right">Package</th>
<th style="text-align:right">Module</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Plain</strong></td>
<td style="text-align:right">114,458 nsec</td>
<td style="text-align:right">1,285,834 nsec</td>
<td style="text-align:right">null</td>
<td style="text-align:right">Exception</td>
</tr>
<tr>
<td><strong>Jar</strong></td>
<td style="text-align:right">118,083 nsec</td>
<td style="text-align:right">1,944,208 nsec</td>
<td style="text-align:right">16,792 nsec</td>
<td style="text-align:right">Exception</td>
</tr>
<tr>
<td><strong>Module</strong></td>
<td style="text-align:right">89,375 nsec</td>
<td style="text-align:right">1,056,292 nsec</td>
<td style="text-align:right">null</td>
<td style="text-align:right">null</td>
</tr>
<tr>
<td><strong>Native-Jar</strong></td>
<td style="text-align:right">42 nsec</td>
<td style="text-align:right">27,833 nsec</td>
<td style="text-align:right">4,250 nsec</td>
<td style="text-align:right">Exception</td>
</tr>
<tr>
<td><strong>Native-Module</strong></td>
<td style="text-align:right">125 nsec</td>
<td style="text-align:right">20,250 nsec</td>
<td style="text-align:right">null</td>
<td style="text-align:right">null</td>
</tr>
<tr>
<td><strong>Plain2</strong></td>
<td style="text-align:right">123,375 nsec</td>
<td style="text-align:right">1,187,500 nsec</td>
<td style="text-align:right">null</td>
<td style="text-align:right">Exception</td>
</tr>
<tr>
<td><strong>Jar2</strong></td>
<td style="text-align:right">117,291 nsec</td>
<td style="text-align:right">1,414,125 nsec</td>
<td style="text-align:right">13,417 nsec</td>
<td style="text-align:right">Exception</td>
</tr>
<tr>
<td><strong>Module2</strong></td>
<td style="text-align:right">88,250 nsec</td>
<td style="text-align:right">1,025,292 nsec</td>
<td style="text-align:right">null</td>
<td style="text-align:right">566,417 nsec</td>
</tr>
<tr>
<td><strong>Native-Jar2</strong></td>
<td style="text-align:right">83 nsec</td>
<td style="text-align:right">20,084 nsec</td>
<td style="text-align:right">2,791 nsec</td>
<td style="text-align:right">Exception</td>
</tr>
<tr>
<td><strong>Native-Module2</strong></td>
<td style="text-align:right">42 nsec</td>
<td style="text-align:right">15,958 nsec</td>
<td style="text-align:right">null</td>
<td style="text-align:right">792 nsec</td>
</tr>
</tbody>
</table>
<p>PCãŒå¤‰ã‚ã£ã¦å…¨ä½“çš„ã«é€Ÿããªã£ãŸï¼
ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‹ã‚‰èª­ã¿è¾¼ã‚€ã®ã¯ï¼Œnativeã‚¤ãƒ¡ãƒ¼ã‚¸ã«ã—ãŸã¨ã—ã¦ã‚‚ï¼Œå®šæ•°å€¤ã‚„Packageï¼ŒModuleã‹ã‚‰èª­ã¿è¾¼ã‚€ã®ã«æ¯”ã¹ã‚‹ã¨é…ã„ï¼
nativeã‚¤ãƒ¡ãƒ¼ã‚¸ã«ã™ã‚‹ã¨ï¼Œæ„å¤–ã¨ Module ã‹ã‚‰èª­ã¿è¾¼ã‚€ã®ãŒæ—©ã„ï¼</p>
<h2 id="references">References</h2>
<ul>
<li><a href="https://tyablog.net/2020/04/05/java-how-different-jmod-and-jar">Java JMOD ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã¯ã€JAR ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã®é•ã„ã€‚</a></li>
<li><a href="https://qiita.com/opengl-8080/items/93c8e0cf58654d5f73cb">ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã‚’å­¦ã¶</a></li>
</ul>


<div id="disqus_thread"></div>
<script type="application/javascript">
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "htamada" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    <footer class="site-footer">
  <span class="site-footer-credits">
    Made with <a href="https://gohugo.io/">Hugo</a>. Theme by <a href="https://github.com/zwbetz-gh/cayman-hugo-theme">Cayman</a>. Deployed to <a href="https://pages.github.com/">GitHub Pages</a>.
  </span>
</footer>

  </section>
  
  

</body>
</html>
